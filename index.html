<script type="module">
        import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, onSnapshot, collection, getDocs, deleteDoc, writeBatch } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";

        let app, db, auth;
        let authReady = false;
        let tournamentDocRef;
        let course = {
            tournamentName: '',
            courseName: '',
            courseRating: 72.0,
            slopeRating: 120,
            pars: Array(18).fill(4),
            hcpIndices: Array.from({ length: 18 }, (_, i) => i + 1)
        };
        let players = [];
        let scores = {};
        let unsubscribePlayers;

        let currentMode = 'player';
        let activePlayerId = null;
        const ORGANIZER_PASSWORD = "8105";

        // DOM Elements
        const organizerModeBtnBottom = document.getElementById('organizerModeBtnBottom');
        const playerModeBtn = document.getElementById('playerModeBtn');
        const organizerContent = document.getElementById('organizerContent');
        const playerContent = document.getElementById('playerContent');
        const resetAllBtn = document.getElementById('resetAllBtn');
        const leaderboardCard = document.getElementById('leaderboardCard');
        const tournamentNameInput = document.getElementById('tournamentName');
        const courseNameInput = document.getElementById('courseName');
        const courseRatingInput = document.getElementById('courseRating');
        const slopeRatingInput = document.getElementById('slopeRating');
        const saveCourseBtn = document.getElementById('saveCourseBtn');
        const playerNameInput = document.getElementById('playerName');
        const playerHandicapInput = document.getElementById('playerHandicap');
        const addPlayerBtn = document.getElementById('addPlayerBtn');
        const playersTableBody = document.querySelector('#playersTable tbody');
        const scoresTableBody = document.querySelector('#scoresTable tbody');
        const calculateScoresBtn = document.getElementById('calculateScoresBtn');
        const playerWelcomeMessage = document.getElementById('playerWelcomeMessage');
        const playerSelect = document.getElementById('playerSelect');
        const playerLoginBtn = document.getElementById('playerLoginBtn');
        const activePlayerScoreRow = document.getElementById('activePlayerScoreRow');
        const playerSaveScoresBtn = document.getElementById('playerSaveScoresBtn');
        const leaderboardTableBody = document.querySelector('#leaderboardTable tbody');
        const messageBox = document.getElementById('messageBox');
        const messageBoxOverlay = document.getElementById('messageBoxOverlay');
        const messageBoxTitle = document.getElementById('messageBoxTitle');
        const messageBoxContent = document.getElementById('messageBoxContent');
        const messageBoxCloseBtn = document.getElementById('messageBoxCloseBtn');
        const passwordModal = document.getElementById('passwordModal');
        const passwordInput = document.getElementById('passwordInput');
        const passwordSubmitBtn = document.getElementById('passwordSubmitBtn');
        const passwordCancelBtn = document.getElementById('passwordCancelBtn');
        const spinner = document.createElement('div');
        spinner.className = 'absolute inset-0 flex items-center justify-center bg-white bg-opacity-75 z-50';
        spinner.innerHTML = '<div class="w-16 h-16 border-4 border-blue-400 border-dashed rounded-full animate-spin"></div>';

        function showMessageBox(title, content) {
            messageBoxTitle.textContent = title;
            messageBoxContent.innerHTML = content;
            messageBox.classList.remove('hidden');
            messageBoxOverlay.classList.remove('hidden');
        }

        function hideMessageBox() {
            messageBox.classList.add('hidden');
            messageBoxOverlay.classList.add('hidden');
        }

        function showPasswordModal(callback) {
            passwordInput.value = '';
            passwordModal.classList.remove('hidden');
            messageBoxOverlay.classList.remove('hidden');
            passwordInput.focus();
            passwordModal._submitCallback = callback;
        }

        function hidePasswordModal() {
            passwordModal.classList.add('hidden');
            messageBoxOverlay.classList.add('hidden');
            passwordModal._submitCallback = null;
        }

        function switchMode(mode) {
            if (mode === 'organizer') {
                showPasswordModal((enteredPassword) => {
                    if (enteredPassword === ORGANIZER_PASSWORD) {
                        currentMode = 'organizer';
                        localStorage.setItem('golfStablefordCurrentMode', currentMode);
                        organizerContent.classList.remove('hidden');
                        playerContent.classList.add('hidden');
                        resetAllBtn.classList.remove('hidden');
                        leaderboardCard.classList.remove('hidden');
                        playerModeBtn.classList.add('btn-secondary');
                        playerModeBtn.classList.remove('btn-primary');
                        organizerModeBtnBottom.classList.add('btn-primary');
                        organizerModeBtnBottom.classList.remove('btn-secondary');
                        showMessageBox("Erfolgreich", "Organisator-Modus aktiviert.");
                        renderPlayers();
                        renderScoresInput();
                    } else {
                        showMessageBox("Zugriff verweigert", "Falsches Passwort.");
                    }
                });
                return;
            }

            currentMode = mode;
            localStorage.setItem('golfStablefordCurrentMode', currentMode);
            organizerContent.classList.add('hidden');
            playerContent.classList.remove('hidden');
            resetAllBtn.classList.add('hidden');
            leaderboardCard.classList.remove('hidden');
            playerModeBtn.classList.add('btn-primary');
            playerModeBtn.classList.remove('btn-secondary');
            organizerModeBtnBottom.classList.add('btn-secondary');
            organizerModeBtnBottom.classList.remove('btn-primary');
            populatePlayerSelect();
            playerWelcomeMessage.textContent = "Bitte wählen Sie Ihren Namen und melden Sie sich an.";
            activePlayerScoreRow.innerHTML = '<td>Schläge</td>';
            playerSaveScoresBtn.disabled = true;
        }

        function populatePlayerSelect() {
            playerSelect.innerHTML = '<option value="">-- Spieler auswählen --</option>';
            players.sort((a, b) => a.name.localeCompare(b.name)).forEach(player => {
                const option = document.createElement('option');
                option.value = player.id;
                option.textContent = player.name;
                playerSelect.appendChild(option);
            });
        }

        async function loginPlayer(playerId) {
            const player = players.find(p => p.id === playerId);
            if (player) {
                activePlayerId = player.id;
                localStorage.setItem('golfStablefordActivePlayerId', activePlayerId);
                playerSelect.value = playerId;
                playerWelcomeMessage.textContent = `Willkommen, ${player.name}!`;
                renderPlayerScoresInput(player);
                playerSaveScoresBtn.disabled = false;
                showMessageBox("Erfolgreich", `Willkommen, ${player.name}!`);
            } else {
                activePlayerId = null;
                localStorage.removeItem('golfStablefordActivePlayerId');
                playerWelcomeMessage.textContent = "Bitte wählen Sie Ihren Namen und melden Sie sich an.";
                activePlayerScoreRow.innerHTML = '<td>Schläge</td>';
                playerSaveScoresBtn.disabled = true;
                showMessageBox("Fehler", "Spieler nicht gefunden.");
            }
        }

        function calculatePlayingHandicap(handicapIndex, courseRating, slopeRating, totalPar) {
            const playingHandicapRaw = (handicapIndex * (slopeRating / 113)) + (courseRating - totalPar);
            return Math.round(playingHandicapRaw);
        }

        function getHandicapStrokesPerHole(playingHandicap, holeHandicapIndex) {
            const baseStrokes = Math.floor(playingHandicap / 18);
            const remainingStrokes = playingHandicap % 18;
            return baseStrokes + (holeHandicapIndex <= remainingStrokes ? 1 : 0);
        }

        function calculateStablefordPoints(grossScore, holePar, playingHandicap, holeHandicapIndex) {
            if (isNaN(grossScore) || grossScore <= 0) return 0;
            const netStrokesForHole = getHandicapStrokesPerHole(playingHandicap, holeHandicapIndex);
            const netParForHole = holePar + netStrokesForHole;
            return Math.max(0, 2 + (netParForHole - grossScore));
        }

        function renderPlayers() {
            playersTableBody.innerHTML = '';
            const totalPar = course.pars ? course.pars.reduce((sum, p) => sum + p, 0) : 0;
            players.forEach((player) => {
                const playingHandicap = calculatePlayingHandicap(player.handicap, course.courseRating, course.slopeRating, totalPar);
                player.playingHandicap = playingHandicap;
                const row = playersTableBody.insertRow();
                row.innerHTML = `
                    <td>${player.name}</td>
                    <td>${player.handicap.toFixed(1)}</td>
                    <td>${player.playingHandicap}</td>
                    <td><button class="btn btn-danger btn-sm" data-player-id="${player.id}">Entfernen</button></td>
                `;
                row.querySelector('button').addEventListener('click', (e) => removePlayer(e.target.dataset.playerId));
            });
        }

        function renderScoresInput() {
            scoresTableBody.innerHTML = '';
            players.forEach(player => {
                const row = scoresTableBody.insertRow();
                row.innerHTML = `<td>${player.name}</td>`;
                for (let i = 1; i <= 18; i++) {
                    const cell = row.insertCell();
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.min = '1';
                    input.max = '15';
                    input.className = 'score-input';
                    input.value = scores[player.id] && scores[player.id][`hole${i}`] ? scores[player.id][`hole${i}`] : '';
                    input.addEventListener('change', (e) => saveScore(player.id, i, parseInt(e.target.value)));
                    cell.appendChild(input);
                }
            });
        }

        function renderPlayerScoresInput(player) {
            activePlayerScoreRow.innerHTML = '<td>Schläge</td>';
            for (let i = 1; i <= 18; i++) {
                const cell = document.createElement('td');
                const input = document.createElement('input');
                input.type = 'number';
                input.min = '1';
                input.max = '15';
                input.className = 'score-input';
                input.value = scores[player.id] && scores[player.id][`hole${i}`] ? scores[player.id][`hole${i}`] : '';
                input.addEventListener('change', (e) => saveScore(player.id, i, parseInt(e.target.value)));
                cell.appendChild(input);
                activePlayerScoreRow.appendChild(cell);
            }
        }

        function calculateAndRenderLeaderboard() {
            const leaderboardData = [];
            const totalPar = course.pars ? course.pars.reduce((sum, p) => sum + p, 0) : 0;
            players.forEach(player => {
                let totalStablefordPoints = 0;
                let playerScores = scores[player.id] || {};
                const playingHandicap = calculatePlayingHandicap(player.handicap, course.courseRating, course.slopeRating, totalPar);
                for (let i = 1; i <= 18; i++) {
                    const holePar = course.pars[i - 1];
                    const holeHcpIndex = course.hcpIndices[i - 1];
                    const grossScore = parseInt(playerScores[`hole${i}`]);
                    if (!isNaN(grossScore) && grossScore > 0) {
                        totalStablefordPoints += calculateStablefordPoints(grossScore, holePar, playingHandicap, holeHcpIndex);
                    }
                }
                player.totalPoints = totalStablefordPoints;
                leaderboardData.push({ name: player.name, handicap: player.handicap, playingHandicap: playingHandicap, totalPoints: totalStablefordPoints });
            });
            leaderboardData.sort((a, b) => b.totalPoints - a.totalPoints);
            leaderboardTableBody.innerHTML = '';
            leaderboardData.forEach((player, index) => {
                const row = leaderboardTableBody.insertRow();
                row.innerHTML = `
                    <td>${index + 1}.</td>
                    <td>${player.name}</td>
                    <td>${player.handicap.toFixed(1)}</td>
                    <td>${player.playingHandicap}</td>
                    <td>${player.totalPoints}</td>
                `;
            });
            if (leaderboardData.length === 0) {
                const row = leaderboardTableBody.insertRow();
                row.innerHTML = `<td colspan="5" class="text-center text-gray-500 py-4">Noch keine Ergebnisse vorhanden.</td>`;
            }
        }

        async function updateCourseData() {
            if (!authReady) return;
            await setDoc(tournamentDocRef, { course: course }, { merge: true });
        }

        async function addPlayerToDB(player) {
            if (!authReady) return;
            const playersCollectionRef = collection(tournamentDocRef, 'players');
            const newPlayerDocRef = doc(playersCollectionRef, player.id);
            await setDoc(newPlayerDocRef, player);
        }

        async function removePlayerFromDB(playerId) {
            if (!authReady) return;
            const playerDocRef = doc(collection(tournamentDocRef, 'players'), playerId);
            await deleteDoc(playerDocRef);
        }

        async function saveScoreToDB(playerId, holeNumber, score) {
            if (!authReady) return;
            const playerDocRef = doc(collection(tournamentDocRef, 'players'), playerId);
            const scoreKey = `scores.hole${holeNumber}`;
            const scoreUpdate = isNaN(score) ? {} : { [scoreKey]: score };
            await setDoc(playerDocRef, scoreUpdate, { merge: true });
        }

        async function resetAllData() {
            if (!authReady) return;
            const batch = writeBatch(db);
            const playersCollectionRef = collection(tournamentDocRef, 'players');
            const playerDocs = await getDocs(playersCollectionRef);
            playerDocs.forEach(d => {
                batch.delete(d.ref);
            });
            course = { tournamentName: '', courseName: '', courseRating: 72.0, slopeRating: 120, pars: Array(18).fill(4), hcpIndices: Array.from({ length: 18 }, (_, i) => i + 1) };
            batch.set(tournamentDocRef, { course: course });
            await batch.commit();
            localStorage.setItem('golfStablefordCurrentMode', 'organizer');
            localStorage.removeItem('golfStablefordActivePlayerId');
            switchMode('organizer');
        }

        async function initFirebase() {
            try {
                const firebaseConfig = {
                    apiKey: "AIzaSyCk-XEKnnWqRlTqVXUFCxGc69JpmhErIT8",
                    authDomain: "rgnt-8105-stableford.firebaseapp.com",
                    projectId: "rgnt-8105-stableford",
                    storageBucket: "rgnt-8105-stableford.firebasestorage.app",
                    messagingSenderId: "774338268555",
                    appId: "1:774338268555:web:ded58e0759d42ee46d338e",
                    measurementId: "G-DXQG00EWHW"
                };
                const appId = firebaseConfig.projectId;

                if (!getApps().length) {
                    app = initializeApp(firebaseConfig);
                } else {
                    app = getApps()[0];
                }

                auth = getAuth(app);
                db = getFirestore(app);
                getAnalytics(app);

                await signInAnonymously(auth);

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        authReady = true;
                        const tournamentsCollection = collection(db, 'tournaments');
                        tournamentDocRef = doc(tournamentsCollection, 'current_tournament');
                        await loadTournamentData();
                    } else {
                        console.log("User is signed out.");
                    }
                });

            } catch (e) {
                console.error("Firebase init failed:", e);
                showMessageBox("Fehler", "Firebase-Initialisierung fehlgeschlagen. Überprüfen Sie die Konfiguration und Firestore-Pfade.");
            }
        }

        async function loadTournamentData() {
            try {
                document.body.appendChild(spinner);
                const docSnap = await getDoc(tournamentDocRef);

                if (docSnap.exists()) {
                    const data = docSnap.data();
                    course = data.course || course;
                    tournamentNameInput.value = course.tournamentName || '';
                    courseNameInput.value = course.courseName || '';
                    courseRatingInput.value = course.courseRating;
                    slopeRatingInput.value = course.slopeRating;
                    if (course.pars) course.pars.forEach((par, i) => { document.getElementById(`par${i + 1}`).value = par; });
                    if (course.hcpIndices) course.hcpIndices.forEach((hcpIndex, i) => { document.getElementById(`hcpIndex${i + 1}`).value = hcpIndex; });
                } else {
                    await setDoc(tournamentDocRef, { course: course });
                }

                if (unsubscribePlayers) unsubscribePlayers();
                const playersCollectionRef = collection(tournamentDocRef, 'players');
                unsubscribePlayers = onSnapshot(playersCollectionRef, (snapshot) => {
                    const loadedPlayers = [];
                    const loadedScores = {};
                    snapshot.forEach(d => {
                        const playerData = d.data();
                        loadedPlayers.push(playerData);
                        loadedScores[d.id] = playerData.scores || {};
                    });
                    players = loadedPlayers;
                    scores = loadedScores;
                    renderPlayers();
                    renderScoresInput();
                    calculateAndRenderLeaderboard();

                    const savedMode = localStorage.getItem('golfStablefordCurrentMode') || 'player';
                    const savedPlayerId = localStorage.getItem('golfStablefordActivePlayerId');

                    if (currentMode === 'player') {
                        populatePlayerSelect();
                        if (savedPlayerId && players.some(p => p.id === savedPlayerId)) {
                           loginPlayer(savedPlayerId);
                        }
                    } else {
                       switchMode(savedMode);
                    }
                    spinner.remove();

                }, (error) => {
                    console.error("Error listening to players:", error);
                    showMessageBox("Fehler", "Fehler beim Laden der Spielerdaten.");
                    spinner.remove();
                });

            } catch (e) {
                console.error("Error loading tournament data:", e);
                showMessageBox("Fehler", "Fehler beim Laden der Turnierdaten.");
                spinner.remove();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            initFirebase();

            passwordSubmitBtn.addEventListener('click', () => {
                const enteredPassword = passwordInput.value;
                if (passwordModal._submitCallback) {
                    passwordModal._submitCallback(enteredPassword);
                }
                hidePasswordModal();
            });
            passwordCancelBtn.addEventListener('click', hidePasswordModal);
            messageBoxCloseBtn.addEventListener('click', hideMessageBox);
            messageBoxOverlay.addEventListener('click', hideMessageBox);

            organizerModeBtnBottom.addEventListener('click', () => switchMode('organizer'));
            playerModeBtn.addEventListener('click', () => switchMode('player'));

            playerLoginBtn.addEventListener('click', () => {
                const selectedPlayerId = playerSelect.value;
                if (selectedPlayerId) {
                    loginPlayer(selectedPlayerId);
                } else {
                    showMessageBox("Fehler", "Bitte wählen Sie einen Spieler aus.");
                }
            });

            calculateScoresBtn.addEventListener('click', () => {
                calculateAndRenderLeaderboard();
                showMessageBox("Erfolg", "Rangliste aktualisiert.");
            });

            saveCourseBtn.addEventListener('click', () => {
                course.tournamentName = tournamentNameInput.value.trim();
                course.courseName = courseNameInput.value.trim();
                course.courseRating = parseFloat(courseRatingInput.value);
                course.slopeRating = parseInt(slopeRatingInput.value);
                const newPars = [];
                const newHcpIndices = [];
                let isValid = true;
                if (isNaN(course.courseRating) || course.courseRating < 50 || course.courseRating > 80) { showMessageBox("Fehler", "Ungültiges Course Rating (erlaubt: 50-80)."); isValid = false; }
                if (isNaN(course.slopeRating) || course.slopeRating < 55 || course.slopeRating > 155) { showMessageBox("Fehler", "Ungültiges Slope Rating (erlaubt: 55-155)."); isValid = false; }
                if (isValid) {
                    for (let i = 1; i <= 18; i++) {
                        const par = parseInt(document.getElementById(`par${i}`).value);
                        const hcpIndex = parseInt(document.getElementById(`hcpIndex${i}`).value);
                        if (isNaN(par) || par < 3 || par > 5) { showMessageBox("Fehler", `Ungültiges Par für Loch ${i} (erlaubt: 3-5).`); isValid = false; break; }
                        if (isNaN(hcpIndex) || hcpIndex < 1 || hcpIndex > 18) { showMessageBox("Fehler", `Ungültiger HCP Index für Loch ${i} (erlaubt: 1-18).`); isValid = false; break; }
                        newPars.push(par);
                        newHcpIndices.push(hcpIndex);
                    }
                }
                if (isValid) {
                    if (new Set(newHcpIndices).size !== 18) {
                        showMessageBox("Fehler", "HCP Indices müssen einzigartig sein (1-18).");
                    } else {
                        course.pars = newPars;
                        course.hcpIndices = newHcpIndices;
                        updateCourseData();
                        showMessageBox("Erfolgreich", "Platz-Einstellungen gespeichert!");
                    }
                }
            });

            addPlayerBtn.addEventListener('click', async () => {
                const name = playerNameInput.value.trim();
                const handicap = parseFloat(playerHandicapInput.value);
                if (!name) { showMessageBox("Fehler", "Spielername fehlt."); return; }
                if (isNaN(handicap) || handicap < 0 || handicap > 54) { showMessageBox("Fehler", "Ungültiger Handicap Index (erlaubt: 0.0-54.0)."); return; }
                if (players.some(p => p.name.toLowerCase() === name.toLowerCase())) { showMessageBox("Fehler", "Ein Spieler mit diesem Namen existiert bereits."); return; }
                const newPlayer = { id: Date.now().toString(), name: name, handicap: handicap, scores: {} };
                await addPlayerToDB(newPlayer);
                playerNameInput.value = '';
                playerHandicapInput.value = '18.0';
                showMessageBox("Erfolgreich", `${name} wurde hinzugefügt.`);
            });

            function removePlayer(playerId) {
                const player = players.find(p => p.id === playerId);
                if (player) {
                    showMessageBox("Bestätigung", `Möchten Sie ${player.name} wirklich entfernen?`);
                    messageBoxCloseBtn.onclick = () => {
                        hideMessageBox();
                        removePlayerFromDB(playerId).then(() => {
                           showMessageBox("Erfolgreich", `${player.name} wurde entfernt.`);
                        });
                        messageBoxCloseBtn.onclick = hideMessageBox;
                    };
                }
            }

            function saveScore(playerId, holeNumber, score) {
                if(scores[playerId]){
                    scores[playerId][`hole${holeNumber}`] = score;
                }
                saveScoreToDB(playerId, holeNumber, score);
            }

            playerSaveScoresBtn.addEventListener('click', () => {
                const activePlayer = players.find(p => p.id === activePlayerId);
                if (!activePlayer) return;

                calculateAndRenderLeaderboard(); // Recalculate to get latest totalPoints

                // Find the updated player data from the leaderboard calculation
                const updatedPlayer = players.find(p => p.id === activePlayerId);
                const playerTotalPoints = updatedPlayer.totalPoints || 0;

                let perHolePointsHtml = `
                    <h4 class="text-lg font-semibold mt-4 mb-2">Ihre Stableford Punkte pro Loch:</h4>
                    <p class="text-sm text-gray-600 mb-2">"Vorgabe" sind die zusätzlichen Schläge pro Loch basierend auf Ihrer Spielvorgabe.</p>
                    <div class="table-container" style="max-height: 40vh; overflow-y: auto;">
                        <table class="w-full text-sm text-left text-gray-700">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50 sticky top-0">
                                <tr>
                                    <th scope="col" class="px-3 py-2">Loch</th>
                                    <th scope="col" class="px-3 py-2 text-center">Par</th>
                                    <th scope="col" class="px-3 py-2 text-center">Vorgabe</th>
                                    <th scope="col" class="px-3 py-2 text-center">Schläge</th>
                                    <th scope="col" class="px-3 py-2 text-center">Punkte</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                const totalPar = course.pars.reduce((sum, p) => sum + p, 0);
                const playingHandicap = calculatePlayingHandicap(activePlayer.handicap, course.courseRating, course.slopeRating, totalPar);
                const playerScores = scores[activePlayer.id] || {};
                for (let i = 1; i <= 18; i++) {
                    const holePar = course.pars[i - 1];
                    const holeHcpIndex = course.hcpIndices[i - 1];
                    const grossScore = playerScores[`hole${i}`] ? parseInt(playerScores[`hole${i}`]) : NaN;
                    const stablefordPoints = calculateStablefordPoints(grossScore, holePar, playingHandicap, holeHcpIndex);
                    const handicapStrokesForHole = getHandicapStrokesPerHole(playingHandicap, holeHcpIndex);
                    perHolePointsHtml += `
                            <tr class="bg-white border-b hover:bg-gray-50">
                                <td class="px-3 py-2 font-medium text-gray-900 whitespace-nowrap">Loch ${i}</td>
                                <td class="px-3 py-2 text-center">${holePar}</td>
                                <td class="px-3 py-2 text-center">${handicapStrokesForHole}</td>
                                <td class="px-3 py-2 text-center">${isNaN(grossScore) ? '-' : grossScore}</td>
                                <td class="px-3 py-2 text-center">${stablefordPoints}</td>
                            </tr>
                        `;
                    }
                    perHolePointsHtml += `
                                </tbody>
                            </table>
                        </div>
                        <p class="text-lg font-bold mt-4">Gesamt Stableford Punkte: ${playerTotalPoints}</p>
                    `;
                showMessageBox("Score Gespeichert", perHolePointsHtml);
            });

            resetAllBtn.addEventListener('click', () => {
                showMessageBox("Bestätigung", "Möchten Sie wirklich alle Turnierdaten zurücksetzen? Diese Aktion kann nicht rückgängig gemacht werden.");
                messageBoxCloseBtn.onclick = () => {
                    hideMessageBox();
                    showPasswordModal((enteredPassword) => {
                        if (enteredPassword === ORGANIZER_PASSWORD) {
                            resetAllData();
                            showMessageBox("Erfolgreich", "Alle Daten wurden zurückgesetzt.");
                        } else {
                            showMessageBox("Zugriff verweigert", "Falsches Passwort.");
                        }
                        messageBoxCloseBtn.onclick = hideMessageBox;
                    });
                };
            });
        });
    </script>
